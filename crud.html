<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Clientes</title>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const token = localStorage.getItem("token");
            if (!token) {
                window.location.href = "index.html";
                return;
            }
            cargarClientes();
        });
        
        function cargarClientes() {
            fetch("https://empresa-fumigacion-latest.onrender.com/api/v1/clientes/all", {
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + localStorage.getItem("token"),
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                const tabla = document.getElementById("clientesBody");
                tabla.innerHTML = "";
                data.forEach(cliente => {
                    const fila = `<tr>
                        <td>${cliente.id}</td>
                        <td>${cliente.nombre}</td>
                        <td>${cliente.direccion}</td>
                        <td>${cliente.telefono}</td>
                        <td>${cliente.correo}</td>
                        <td>
                            <button onclick="editarCliente('${cliente.id}')">Editar</button>
                            <button onclick="eliminarCliente('${cliente.id}')">Eliminar</button>
                        </td>
                    </tr>`;
                    tabla.innerHTML += fila;
                });
            })
            .catch(error => console.error("Error al cargar clientes:", error));
        }
        
        function eliminarCliente(id) {
            if (confirm("¿Seguro que deseas eliminar este cliente?")) {
                fetch(`https://empresa-fumigacion-latest.onrender.com/api/v1/clientes/delete/${id}`, {
                    method: "DELETE",
                    headers: {
                        "Authorization": "Bearer " + localStorage.getItem("token"),
                        "Content-Type": "application/json"
                    }
                })
                .then(response => {
                    if (response.ok) {
                        alert("Cliente eliminado correctamente");
                        cargarClientes();
                    } else {
                        alert("Error al eliminar cliente");
                    }
                })
                .catch(error => console.error("Error al eliminar cliente:", error));
            }
        }
        
        function editarCliente(id) {
            const nuevoNombre = prompt("Nuevo nombre del cliente:");
            if (nuevoNombre) {
                fetch(`https://empresa-fumigacion-latest.onrender.com/api/v1/clientes/put/${id}`, {
                    method: "PUT",
                    headers: {
                        "Authorization": "Bearer " + localStorage.getItem("token"),
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ nombre: nuevoNombre })
                })
                .then(response => {
                    if (response.ok) {
                        alert("Cliente actualizado correctamente");
                        cargarClientes();
                    } else {
                        alert("Error al actualizar cliente");
                    }
                })
                .catch(error => console.error("Error al actualizar cliente:", error));
            }
        }
    </script>
</head>
<body>
    <h1>Lista de Clientes</h1>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Dirección</th>
                <th>Teléfono</th>
                <th>Correo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="clientesBody"></tbody>
    </table>
</body>
</html>
